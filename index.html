<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1win Mines Predictor</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-dark: #070b14;
            --accent-blue: #007aff;
            --star-gold: #ffb700;
            --cell-border: #233044;
        }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 122, 255, 0.1) 0%, transparent 80%);
            color: white;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Логотип 1win */
        .logo {
            width: 130px;
            margin-bottom: 30px;
            filter: drop-shadow(0 0 15px rgba(0, 122, 255, 0.4));
        }

        /* Контейнер сетки */
        .game-wrapper {
            background: rgba(21, 28, 44, 0.9);
            padding: 15px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            margin-bottom: 25px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .cell {
            width: 54px;
            height: 54px;
            background: linear-gradient(145deg, #1c293d, #0e1624);
            border-radius: 12px;
            border: 1px solid var(--cell-border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        /* Стилизация активной звезды */
        .cell.active {
            background: var(--star-gold);
            border: none;
            box-shadow: 0 0 20px rgba(255, 183, 0, 0.5), inset 0 0 8px rgba(255,255,255,0.4);
            transform: scale(1.08);
            animation: star-pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .star-icon {
            width: 32px;
            height: 32px;
            fill: white;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }

        @keyframes star-pop {
            0% { transform: scale(0.4); opacity: 0; }
            100% { transform: scale(1.08); opacity: 1; }
        }

        /* Панель управления */
        .controls {
            width: 80%;
            max-width: 300px;
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 22px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .arrow {
            font-size: 26px;
            color: var(--accent-blue);
            cursor: pointer;
            padding: 0 15px;
            user-select: none;
        }

        .mine-info { text-align: center; }
        .mine-info b { font-size: 22px; display: block; line-height: 1; }
        .mine-info span { font-size: 11px; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }

        /* Кнопка Play */
        .play-btn {
            width: 100%;
            height: 52px;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: opacity 0.2s;
        }

        .play-btn:disabled {
            background: #2d3d57;
            color: #8a96ab;
            cursor: not-allowed;
        }

        .cooldown-progress {
            position: absolute;
            left: 0; top: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.15);
            width: 0%;
        }
    </style>
</head>
<body>

    <img src="https://1win.pro/img/logo.png" alt="1win" class="logo" onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/star.png'">

    <div class="game-wrapper">
        <div class="grid" id="grid"></div>
    </div>

    <div class="controls">
        <div class="selector">
            <div class="arrow" onclick="changeMines(-1)">❮</div>
            <div class="mine-info">
                <b id="mine-count">3</b>
                <span>traps</span>
            </div>
            <div class="arrow" onclick="changeMines(1)">❯</div>
        </div>

        <button id="play-btn" class="play-btn" onclick="runPrediction()">
            <span id="btn-text">Play</span>
            <div id="cd-progress" class="cooldown-progress"></div>
        </button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const grid = document.getElementById('grid');
        const mineLabel = document.getElementById('mine-count');
        const playBtn = document.getElementById('play-btn');
        const btnText = document.getElementById('btn-text');
        const cdBar = document.getElementById('cd-progress');

        let mines = 3;
        const config = { 1: 7, 3: 5, 5: 4, 7: 3 };
        const levels = [1, 3, 5, 7];
        const starIcon = `<svg class="star-icon" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`;

        function createGrid() {
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                grid.appendChild(cell);
            }
        }

        function changeMines(step) {
            let idx = levels.indexOf(mines) + step;
            if (idx >= 0 && idx < levels.length) {
                mines = levels[idx];
                mineLabel.innerText = mines;
            }
        }

        function runPrediction() {
            createGrid(); // Сброс поля
            playBtn.disabled = true;

            const starCount = config[mines];
            const cells = Array.from({length: 25}, (_, i) => i);
            const selected = cells.sort(() => Math.random() - 0.5).slice(0, starCount);

            // Звезды появляются сразу с интервалом 0.5 сек
            selected.forEach((cellIdx, i) => {
                setTimeout(() => {
                    const cell = grid.children[cellIdx];
                    cell.classList.add('active');
                    cell.innerHTML = starIcon;
                    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
                }, i * 500); 
            });

            handleCooldown(10);
        }

        function handleCooldown(duration) {
            let time = duration;
            btnText.innerText = time;
            
            const timer = setInterval(() => {
                time--;
                btnText.innerText = time;
                cdBar.style.width = ((duration - time) / duration * 100) + '%';

                if (time <= 0) {
                    clearInterval(timer);
                    playBtn.disabled = false;
                    btnText.innerText = 'Play';
                    cdBar.style.width = '0%';
                }
            }, 1000);
        }

        createGrid();
    </script>
</body>
</html>